import json
import os

def main():
    # Read results
    try:
        with open("results.json", "r") as f:
            data = json.load(f)
    except FileNotFoundError:
        print("Error: results.json not found.")
        return

    # HTML Template
    html_template = """
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benchmark Results - Apple M4 Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f5f5f7; color: #1d1d1f; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 40px; }
        .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; font-size: 1.2rem; color: #86868b; }
        canvas { max-height: 300px; }
        .summary { text-align: center; margin-bottom: 20px; }
        .footer { text-align: center; margin-top: 50px; color: #86868b; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Multi-Language Benchmark: M4 Pro</h1>
        <div class="summary">
            <p><strong>Hardware:</strong> Apple M4 Pro (ARM64) | <strong>OS:</strong> macOS</p>
            <p>Lower bars are better (Execution Time in Seconds)</p>
        </div>
        <div id="charts"></div>
        <div class="footer">Generated by Antigravity</div>
    </div>

    <script>
        const results = DATA_PLACEHOLDER;
        const container = document.getElementById('charts');
        
        const colors = {
            'C': '#555555',
            'C++': '#00599C',
            'Rust': '#dea584',
            'Go': '#00ADD8',
            'Python': '#3776AB',
            'JavaScript': '#F7DF1E',
            'Assembly': '#FF0000'
        };

        Object.keys(results).forEach((benchName, index) => {
            const benchData = results[benchName];
            
            // Create Card
            const card = document.createElement('div');
            card.className = 'card';
            
            const title = document.createElement('h2');
            title.innerText = benchName;
            card.appendChild(title);
            
            const canvasContainer = document.createElement('div');
            canvasContainer.style.position = 'relative';
            canvasContainer.style.height = '300px';
            
            const canvas = document.createElement('canvas');
            canvas.id = 'chart-' + index;
            canvasContainer.appendChild(canvas);
            card.appendChild(canvasContainer);
            container.appendChild(card);
            
            // Chart.js
            const labels = Object.keys(benchData).sort((a,b) => benchData[a] - benchData[b]);
            const data = labels.map(l => benchData[l]);
            const bgColors = labels.map(l => colors[l] || '#cccccc');

            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Time (s)',
                        data: data,
                        backgroundColor: bgColors,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { beginAtZero: true, title: { display: true, text: 'Seconds (Lower is Better)' } }
                    }
                }
            });
        });
    </script>
</body>
</html>
    """

    # Inject data
    html_content = html_template.replace("DATA_PLACEHOLDER", json.dumps(data))

    with open("report.html", "w") as f:
        f.write(html_content)
    
    print("Report generated: report.html")

if __name__ == "__main__":
    main()
