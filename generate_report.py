import json
import os

def main():
    try:
        with open("results.json", "r") as f:
            data = json.load(f)
    except FileNotFoundError:
        print("Error: results.json not found.")
        return

    html_template = """
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Language Benchmark - Apple M4 Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f5f5f7; color: #1d1d1f; padding: 20px; line-height: 1.5; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; font-weight: 700; letter-spacing: -0.02em; }
        .card { background: white; border-radius: 16px; padding: 24px; margin-bottom: 32px; box-shadow: 0 8px 30px rgba(0,0,0,0.04); border: 1px solid #e5e5e7; }
        h2 { margin-top: 0; font-size: 1.5rem; color: #1d1d1f; border-bottom: 2px solid #f5f5f7; padding-bottom: 12px; margin-bottom: 24px; display: flex; align-items: center; justify-content: space-between; }
        .charts-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
        .chart-box { min-width: 0; }
        h3 { font-size: 0.9rem; color: #86868b; text-align: center; margin-bottom: 12px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em; }
        canvas { max-height: 350px; width: 100% !important; }
        .summary { text-align: center; margin-bottom: 40px; }
        .summary p { margin: 4px 0; color: #515154; }
        .footer { text-align: center; margin-top: 60px; color: #86868b; font-size: 0.85rem; padding-bottom: 40px; }
        .badge { background: #0071e3; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        @media (max-width: 1000px) { .charts-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Multi-Language Benchmark: M4 Pro</h1>
        <div class="summary">
            <p><strong>Hardware:</strong> Apple M4 Pro (ARM64) | <strong>OS:</strong> macOS Sequoia</p>
            <p>Comparison of <strong>Speed</strong> (Seconds), <strong>Memory</strong> (MB), and <strong>Efficiency</strong> (Joules)</p>
        </div>
        <div id="charts"></div>
        <div class="footer">Generated by Antigravity AI | 2026-01-31</div>
    </div>

    <script>
        const results = DATA_PLACEHOLDER;
        const chartsContainer = document.getElementById('charts');
        
        const colors = {
            'C': '#5E6771',
            'C++': '#00599C',
            'Rust': '#CEA45D',
            'Go': '#00ADD8',
            'Swift': '#F05138',
            'Java': '#ED8B00',
            'Zig': '#F7A41D',
            'Python': '#3776AB',
            'Python++': '#FFD43B',
            'JavaScript': '#F7DF1E',
            'Assembly': '#000000'
        };

        Object.keys(results).forEach((benchName) => {
            const benchData = results[benchName];
            
            const card = document.createElement('div');
            card.className = 'card';
            
            const title = document.createElement('h2');
            title.innerHTML = `<span>${benchName}</span> <span class="badge">Benchmark</span>`;
            card.appendChild(title);
            
            const row = document.createElement('div');
            row.className = 'charts-row';
            
            const createBox = (title) => {
                const box = document.createElement('div');
                box.className = 'chart-box';
                const h3 = document.createElement('h3');
                h3.innerText = title;
                box.appendChild(h3);
                const canvas = document.createElement('canvas');
                box.appendChild(canvas);
                return { box, canvas };
            };

            const timeChart = createBox('Execution Time (s)');
            const memChart = createBox('Peak Memory (MB)');
            const energyChart = createBox('Energy Usage (J)');
            
            row.appendChild(timeChart.box);
            row.appendChild(memChart.box);
            row.appendChild(energyChart.box);
            card.appendChild(row);
            chartsContainer.appendChild(card);

            // Sorting logic
            const langs = Object.keys(benchData).sort((a, b) => benchData[a][0] - benchData[b][0]);
            
            const timeData = langs.map(l => benchData[l][0]);
            const memData = langs.map(l => benchData[l][1]);
            const energyData = langs.map(l => benchData[l][2] || 0);
            const bgColors = langs.map(l => colors[l] || '#D2D2D7');

            const commonOptions = {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { 
                    x: { 
                        beginAtZero: true,
                        grid: { color: '#f5f5f7' },
                        ticks: { color: '#86868b' }
                    },
                    y: {
                        grid: { display: false },
                        ticks: { color: '#1d1d1f', font: { weight: '500' } }
                    }
                }
            };

            new Chart(timeChart.canvas, {
                type: 'bar',
                data: { labels: langs, datasets: [{ data: timeData, backgroundColor: bgColors, borderRadius: 4 }] },
                options: commonOptions
            });

            new Chart(memChart.canvas, {
                type: 'bar',
                data: { labels: langs, datasets: [{ data: memData, backgroundColor: bgColors, borderRadius: 4 }] },
                options: commonOptions
            });

            new Chart(energyChart.canvas, {
                type: 'bar',
                data: { labels: langs, datasets: [{ data: energyData, backgroundColor: bgColors, borderRadius: 4 }] },
                options: commonOptions
            });
        });
    </script>
</body>
</html>
    """

    html_content = html_template.replace("DATA_PLACEHOLDER", json.dumps(data))

    with open("report.html", "w") as f:
        f.write(html_content)
    
    print("Green Report generated: report.html")

if __name__ == "__main__":
    main()
